# Flux kustomize sample

Flux v2 uses the Kustomize controller to apply YAML files from different sources. The _Kustomize controller_ watches for `kustomize.toolkit.fluxcd.io` resources and applies the manifests that are generated by the _flux kustomize build_ process.

# Testing apply kustomize build

# Create a cluster
To create a cluster, run the following command:

```bash
kind create cluster --name flux-build-demo
```

## Get the kubeconfig

```bash
kind get kubeconfig --name flux-build-demo > ~/.kube/config
```

## Test applying

```bash
flux build kustomization demo-kustomization --dry-run --path ./demo --kustomization-file ./demo/flux-kustomization.yaml
```

!!! warning Failed flux build in K8s
    A failed flux kustomize build in K8s will not apply any of the resources. If you are installing `CRDs` as part of a Helm chart, and using the `CRDs` in the same `Flux kustomize build` then you will need to apply the `CRDs` first.

## Gotchas

If you are using Apple M1 and want to use ´kind´, please follow the instructions on: <https://docs.docker.com/desktop/release-notes/#for-mac-5>.
## Builds

[![Flux Build and Deploy](https://github.com/fredrkl/flux-kustomize-sample/actions/workflows/flux-build.yaml/badge.svg)](https://github.com/fredrkl/flux-kustomize-sample/actions/workflows/flux-build.yaml)
